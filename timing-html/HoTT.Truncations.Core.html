<html>
<head>
<title>Core.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Core.v</h1>

<div class="code" title="File: Core.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 2
Time: 0.035s">
<div class="time" style="width: 15.909090909091%"></div>
<pre>Require Import Basics Types.</pre>
</div>
<div class="code" title="File: Core.v
Line: 2
Time: 0.005s">
<div class="time" style="width: 2.2727272727273%"></div>
<pre>
Require Import TruncType HProp UnivalenceImpliesFunext.</pre>
</div>
<div class="code" title="File: Core.v
Line: 3
Time: 0.066s">
<div class="time" style="width: 30%"></div>
<pre>
Require Import Modalities.Modality Modalities.Identity.</pre>
</div>
<div class="code" title="File: Core.v
Line: 4
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Truncations of types, in all dimensions. *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 7
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 7
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Generalizable Variables A X n.</pre>
</div>
<div class="code" title="File: Core.v
Line: 8
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Definition. *)

(** The definition of [Trunc n], the n-truncation of a type.

If Coq supported higher inductive types natively, we would construct this as somthing like:

   Inductive Trunc n (A : Type) : Type :=
   | tr : A -&gt; Trunc n A
   | istrunc_truncation : forall (f : Sphere n.+1 -&gt; Trunc n A)
       (x : Sphere n.+1), f x = f North.

However, while we are faking our higher-inductives anyway, we can take some shortcuts, rather than translating the definition above.  Firstly, we directly posit a “constructor” giving truncatedness, rather than rephrasing it in terms of maps of spheres.  Secondly, we omit the “computation rule” for this constructor, since it is implied by truncatedness of the result type (and, for essentially that reason, is never wanted in practice anyway).
*)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 23
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Export Trunc.</pre>
</div>
<div class="code" title="File: Core.v
Line: 23
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Delimit Scope trunc_scope with trunc.</pre>
</div>
<div class="code" title="File: Core.v
Line: 24
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Private Inductive Trunc (n : trunc_index) (A :Type) : Type :=
  tr : A -&gt; Trunc n A.</pre>
</div>
<div class="code" title="File: Core.v
Line: 27
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Bind Scope trunc_scope with Trunc.</pre>
</div>
<div class="code" title="File: Core.v
Line: 28
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments tr {n A} a.</pre>
</div>
<div class="code" title="File: Core.v
Line: 29
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Without explicit universe parameters, this instance is insufficiently polymorphic. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 31
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance istrunc_truncation (n : trunc_index) (A : Type@{i})
: IsTrunc@{j} n (Trunc@{i} n A).</pre>
</div>
<div class="code" title="File: Core.v
Line: 32
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Admitted.</pre>
</div>
<div class="code" title="File: Core.v
Line: 33
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>

Definition Trunc_ind {n A}
  (P : Trunc n A -&gt; Type) {Pt : forall aa, IsTrunc n (P aa)}
  : (forall a, P (tr a)) -&gt; (forall aa, P aa)
:= (fun f aa =&gt; match aa with tr a =&gt; fun _ =&gt; f a end Pt).</pre>
</div>
<div class="code" title="File: Core.v
Line: 38
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Trunc.</pre>
</div>
<div class="code" title="File: Core.v
Line: 40
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The non-dependent version of the eliminator. *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 43
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>Definition Trunc_rec {n A X} `{IsTrunc n X}
  : (A -&gt; X) -&gt; (Trunc n A -&gt; X)
:= Trunc_ind (fun _ =&gt; X).</pre>
</div>
<div class="code" title="File: Core.v
Line: 45
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** [Trunc] is a modality *)

(** We will define a truncation modality to be parametrized by a [trunc_index].  However, as described in Modality.v, we don't want to simply define [Truncation_Modalities.Modality] to *be* [trunc_index]; we want to think of the truncation modality as being *derived from* rather than *identical to* its truncation index.  In particular, there is a coercion [O_reflector] from [Modality] to [Funclass], but we don't want Coq to print things like [2 X] to mean [Trunc 2 X].  However, in the special case of truncation, it is nevertheless convenient for [Truncation_Modalities.Modality] to be definitionally equal to [trunc_index], so that we can call modality functions (particularly connectedness functions) passing a truncation index directly.

These may seem like contradictory requirements, but it appears to be possible to satisfy them because coercions don't unfold definitions.  Thus, rather than a record wrapper, we define a *definitional* wrapper [Truncation_Modality] around [trunc_index], and a notation [Tr] for the identity.  We will define [Truncation_Modalities.Modality] to be [Truncation_Modality] and declare the identity as a coercion; thus a [Truncation_Modality] can be used as a modality and therefore also as a function (via the [O_reflector] coercion).  However, the identity from [trunc_index] to [Truncation_Modality] is not a coercion, so we don't get notation like [2 X]. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 51
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition Truncation_Modality := trunc_index.</pre>
</div>
<div class="code" title="File: Core.v
Line: 51
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Definition Tr : trunc_index -&gt; Truncation_Modality := idmap.</pre>
</div>
<div class="code" title="File: Core.v
Line: 52
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Module Truncation_Modalities &lt;: Modalities.</pre>
</div>
<div class="code" title="File: Core.v
Line: 54
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Modality : Type2@{u a} := Truncation_Modality.</pre>
</div>
<div class="code" title="File: Core.v
Line: 56
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_reflector (n : Modality@{u u'}) A := Trunc n A.</pre>
</div>
<div class="code" title="File: Core.v
Line: 58
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition In (n : Modality@{u u'}) A := IsTrunc n A.</pre>
</div>
<div class="code" title="File: Core.v
Line: 60
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_inO (n : Modality@{u u'}) A : In n (O_reflector n A).</pre>
</div>
<div class="code" title="File: Core.v
Line: 62
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 63
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold In, O_reflector; exact _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 64
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 65
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition to (n : Modality@{u u'}) A := @tr n A.</pre>
</div>
<div class="code" title="File: Core.v
Line: 67
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>

  Definition inO_equiv_inO (n : Modality@{u u'})
             (A : Type@{i}) (B : Type@{j}) Atr f feq
  : let gei := ((fun x =&gt; x) : Type@{i} -&gt; Type@{k}) in
    let gej := ((fun x =&gt; x) : Type@{j} -&gt; Type@{k}) in
    In n B
  := @trunc_equiv A B f n Atr feq.</pre>
</div>
<div class="code" title="File: Core.v
Line: 74
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition hprop_inO `{Funext} (n : Modality@{u u'}) A
  : IsHProp (In n A).</pre>
</div>
<div class="code" title="File: Core.v
Line: 77
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 78
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold In; exact _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 79
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 80
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_ind_internal
  : forall (n : Modality@{u a})
           (A : Type@{i}) (B : O_reflector n A -&gt; Type@{j})
           (B_inO : forall oa, In@{u a j} n (B oa)),
      let gei := ((fun x =&gt; x) : Type@{i} -&gt; Type@{k}) in
      let gej := ((fun x =&gt; x) : Type@{j} -&gt; Type@{k}) in
      (forall a, B (to n A a)) -&gt; forall a, B a
    := @Trunc_ind.</pre>
</div>
<div class="code" title="File: Core.v
Line: 89
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>

  Definition O_ind_beta_internal (n : Modality@{u u'})
             A B Btr f a
  : O_ind_internal n A B Btr f (to n A a) = f a
    := 1.</pre>
</div>
<div class="code" title="File: Core.v
Line: 94
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition minO_paths (n : Modality@{u a})
             (A : Type@{i}) (Atr : In@{u a i} n A) (a a' : A)
  : In@{u a i} n (a = a').</pre>
</div>
<div class="code" title="File: Core.v
Line: 98
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 99
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>
    unfold In in *; exact _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 101
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition IsSepFor@{u a} (n' n : Modality@{u a}) : Type@{u}
    := (paths@{a} n.+1 n').</pre>
</div>
<div class="code" title="File: Core.v
Line: 104
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition inO_paths_from_inSepO@{u a i iplus}
             (n' n : Modality@{u a}) (sep : IsSepFor n' n)
             (A : Type@{i}) (A_inO : In@{u a i} n' A) (x y : A)
    : In@{u a i} n (x = y).</pre>
</div>
<div class="code" title="File: Core.v
Line: 109
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    destruct sep; unfold In in *.</pre>
</div>
<div class="code" title="File: Core.v
Line: 111
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 112
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition inSepO_from_inO_paths@{u a i iplus}
             (n' n : Modality@{u a}) (sep : IsSepFor n' n)
             (A : Type@{i}) (inO_pathsA : forall (x y : A), In@{u a i} n (x = y))
    : In@{u a i} n' A.</pre>
</div>
<div class="code" title="File: Core.v
Line: 118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    destruct sep; unfold In in *.</pre>
</div>
<div class="code" title="File: Core.v
Line: 120
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros x y; apply inO_pathsA.</pre>
</div>
<div class="code" title="File: Core.v
Line: 121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 122
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>

End Truncation_Modalities.</pre>
</div>
<div class="code" title="File: Core.v
Line: 124
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** If you import the following module [TrM], then you can call all the modality functions with a [trunc_index] as the modality parameter, since we defined [Truncation_Modalities.Modality] to be [trunc_index]. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 126
Time: 0.22s">
<div class="time" style="width: 100%"></div>
<pre>Module Import TrM := Modalities_Theory Truncation_Modalities.</pre>
</div>
<div class="code" title="File: Core.v
Line: 126
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
(** If you don't import it, then you'll need to write [TrM.function_name] or [TrM.RSU.function_name] depending on whether [function_name] pertains only to modalities or also to reflective subuniverses.  (Having to know this is a bit unfortunate, but apparently the fact that [TrM] [Export]s reflective subuniverses still doesn't make the fields of the latter accessible as [TrM.field].) *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Export TrM.Coercions.</pre>
</div>
<div class="code" title="File: Core.v
Line: 127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Export TrM.RSU.Coercions.</pre>
</div>
<div class="code" title="File: Core.v
Line: 128
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Here is the additional coercion promised above. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 130
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Coercion Truncation_Modality_to_Modality := idmap : Truncation_Modality -&gt; Modality.</pre>
</div>
<div class="code" title="File: Core.v
Line: 130
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Sometimes we also need an explicit definition of the truncation reflective subuniverses. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 132
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>Module Truncation_RSUs := Modalities_to_ReflectiveSubuniverses Truncation_Modalities.</pre>
</div>
<div class="code" title="File: Core.v
Line: 132
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section TruncationModality.</pre>
</div>
<div class="code" title="File: Core.v
Line: 134
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (n : trunc_index).</pre>
</div>
<div class="code" title="File: Core.v
Line: 135
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition trunc_iff_isequiv_truncation (A : Type)
    : IsTrunc n A &lt;-&gt; IsEquiv (@tr n A)
    := inO_iff_isequiv_to_O n A.</pre>
</div>
<div class="code" title="File: Core.v
Line: 139
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Global Instance isequiv_tr A `{IsTrunc n A} : IsEquiv (@tr n A)
    := fst (trunc_iff_isequiv_truncation A) _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 142
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>

  Definition equiv_tr (A : Type) `{IsTrunc n A}
    : A &lt;~&gt; Tr n A
  := Build_Equiv _ _ (@tr n A) _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 146
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>

  Definition untrunc_istrunc {A : Type} `{IsTrunc n A}
    : Tr n A -&gt; A
    := (@tr n A)^-1.</pre>
</div>
<div class="code" title="File: Core.v
Line: 150
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** ** Functoriality *)

 </pre>
</div>
<div class="code" title="File: Core.v
Line: 154
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>Definition Trunc_functor {X Y : Type} (f : X -&gt; Y)
    : Tr n X -&gt; Tr n Y
    := O_functor n f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 156
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>

  Global Instance Trunc_functor_isequiv {X Y : Type}
    (f : X -&gt; Y) `{IsEquiv _ _ f}
    : IsEquiv (Trunc_functor f)
    := isequiv_O_functor n f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 161
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>

  Definition Trunc_functor_equiv {X Y : Type} (f : X &lt;~&gt; Y)
    : Tr n X &lt;~&gt; Tr n Y
    := equiv_O_functor n f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 165
Time: 0.003s">
<div class="time" style="width: 1.3636363636364%"></div>
<pre>

  Definition Trunc_functor_compose {X Y Z} (f : X -&gt; Y) (g : Y -&gt; Z)
    : Trunc_functor (g o f) == Trunc_functor g o Trunc_functor f
    := O_functor_compose n f g.</pre>
</div>
<div class="code" title="File: Core.v
Line: 169
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Trunc_functor_idmap (X : Type)
    : @Trunc_functor X X idmap == idmap
    := O_functor_idmap n X.</pre>
</div>
<div class="code" title="File: Core.v
Line: 173
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>

  Definition isequiv_Trunc_functor {X Y} (f : X -&gt; Y) `{IsEquiv _ _ f}
    : IsEquiv (Trunc_functor f)
    := isequiv_O_functor n f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 177
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>

  Definition equiv_Trunc_prod_cmp `{Funext} {X Y}
    : Tr n (X * Y) &lt;~&gt; Tr n X * Tr n Y
    := equiv_O_prod_cmp n X Y.</pre>
</div>
<div class="code" title="File: Core.v
Line: 181
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Separatedness *)

 </pre>
</div>
<div class="code" title="File: Core.v
Line: 185
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance issepfor_trunc n : IsSepFor n.+1 n
    := idpath.</pre>
</div>
<div class="code" title="File: Core.v
Line: 186
Time: 0.002s">
<div class="time" style="width: 0.90909090909091%"></div>
<pre>

End TruncationModality.</pre>
</div>
<div class="code" title="File: Core.v
Line: 188
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We have to teach Coq to translate back and forth between [IsTrunc n] and [In (Tr n)]. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 190
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance inO_tr_istrunc {n : trunc_index} (A : Type) `{IsTrunc n A}
  : In (Tr n) A.</pre>
</div>
<div class="code" title="File: Core.v
Line: 191
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 192
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assumption.</pre>
</div>
<div class="code" title="File: Core.v
Line: 193
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 194
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Having both of these as [Instance]s would cause infinite loops. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 196
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition istrunc_inO_tr {n : trunc_index} (A : Type) `{In (Tr n) A}
  : IsTrunc n A.</pre>
</div>
<div class="code" title="File: Core.v
Line: 197
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 198
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assumption.</pre>
</div>
<div class="code" title="File: Core.v
Line: 199
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 200
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Instead, we make the latter an immediate instance. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 202
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Hint Immediate istrunc_inO_tr : typeclass_instances.</pre>
</div>
<div class="code" title="File: Core.v
Line: 202
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Unfortunately, this isn't perfect; Coq still can't always find [In n] hypotheses in the context when it wants [IsTrunc]. *)

(** We do the same for [IsTruncMap n] and [MapIn (Tr n)]. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 206
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance mapinO_tr_istruncmap {n : trunc_index} {A B : Type}
  (f : A -&gt; B) `{IsTruncMap n A B f}
  : MapIn (Tr n) f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 208
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 209
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assumption.</pre>
</div>
<div class="code" title="File: Core.v
Line: 210
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 211
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition istruncmap_mapinO_tr {n : trunc_index} {A B : Type}
  (f : A -&gt; B) `{MapIn (Tr n) _ _ f}
  : IsTruncMap n f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 215
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 216
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assumption.</pre>
</div>
<div class="code" title="File: Core.v
Line: 217
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 218
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Hint Immediate istruncmap_mapinO_tr : typeclass_instances.</pre>
</div>
<div class="code" title="File: Core.v
Line: 220
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** It's sometimes convenient to use "infinity" to refer to the identity modality in a similar way.  This clashes with some uses in higher topos theory, where "oo-truncated" means instead "hypercomplete", but this has not yet been a big problem. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 223
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Notation oo := purely.</pre>
</div>
<div class="code" title="File: Core.v
Line: 223
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
(** Unfortunately, we can't import two or more copies of [Modalities_Theory] at the same time (the most recently imported shadows the other(s)).  If we ever want to talk about truncation and include [oo], we may want to define a "union" instance of [Modality]. *)

(** ** A few special things about the (-1)-truncation. *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 227
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Open Scope trunc_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 227
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We define [merely A] to be an inhabitant of the universe [hProp] of hprops, rather than a type.  We can always treat it as a type because there is a coercion, but this means that if we need an element of [hProp] then we don't need a separate name for it. *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 230
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition merely (A : Type@{i}) : hProp@{i} := BuildhProp (Trunc (-1) A).</pre>
</div>
<div class="code" title="File: Core.v
Line: 230
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Note that we define [merely] using [Trunc -1] rather than [Tr -1].  These are of course judgmentally equal, but our choice introduces fewer universe parameters, resulting in faster compilation times.  The other choice might in theory give Coq an easier time applying general modality theorems to [merely], but currently things seem to be transparent enough that it doesn't matter. *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 233
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition hexists {X} (P : X -&gt; Type) : hProp := merely (sigT P).</pre>
</div>
<div class="code" title="File: Core.v
Line: 233
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition hor (P Q : Type) : hProp := merely (P + Q).</pre>
</div>
<div class="code" title="File: Core.v
Line: 235
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Notation "A \/ B" := (hor A B) : type_scope.</pre>
</div>
<div class="code" title="File: Core.v
Line: 237
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition himage {X Y} (f : X -&gt; Y) := image (-1) f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 239
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition contr_inhab_prop {A} `{IsHProp A} (ma : merely A) : Contr A.</pre>
</div>
<div class="code" title="File: Core.v
Line: 241
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 242
Time: 0.003s">
<div class="time" style="width: 1.3636363636364%"></div>
<pre>
  refine (@contr_trunc_conn (-1) A _ _); try assumption.</pre>
</div>
<div class="code" title="File: Core.v
Line: 243
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (contr_inhabited_hprop _ ma).</pre>
</div>
<div class="code" title="File: Core.v
Line: 244
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 245
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Surjections are the (-1)-connected maps, but they can be characterized more simply since an inhabited hprop is automatically contractible. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 247
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Notation IsSurjection := (IsConnMap (-1)).</pre>
</div>
<div class="code" title="File: Core.v
Line: 247
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition BuildIsSurjection {A B} (f : A -&gt; B)
  : (forall b, merely (hfiber f b)) -&gt; IsSurjection f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 250
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 251
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros H b; refine (contr_inhabited_hprop _ _).</pre>
</div>
<div class="code" title="File: Core.v
Line: 252
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply H.</pre>
</div>
<div class="code" title="File: Core.v
Line: 253
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition isequiv_surj_emb {A B} (f : A -&gt; B)
  `{IsSurjection f} `{IsEmbedding f}
  : IsEquiv f.</pre>
</div>
<div class="code" title="File: Core.v
Line: 258
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 259
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply (@isequiv_conn_ino_map (-1)); assumption.</pre>
</div>
<div class="code" title="File: Core.v
Line: 260
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 261
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Tactic to remove truncations in hypotheses if possible. *)</pre>
</div>
<div class="code" title="File: Core.v
Line: 263
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Ltac strip_truncations :=
  (** search for truncated hypotheses *)
  progress repeat match goal with
                    | [ T : _ |- _ ]
                      =&gt; revert_opaque T;
                        refine (@Trunc_ind _ _ _ _ _);
                        (** ensure that we didn't generate more than one subgoal, i.e. that the goal was appropriately truncated *)
                        [];
                        intro T
                  end.</pre>
</div>
<div class="code" title="File: Core.v
Line: 272
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Path-spaces of truncations *)

(** These are just special cases of results about subuniverses of separated types. *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 277
Time: 0.002s">
<div class="time" style="width: 0.90909090909091%"></div>
<pre>Definition path_Tr {n A} (x y : A)
  : Tr n (x = y) -&gt; (tr x = tr y :&gt; Tr n.+1 A)
  := path_SepO x y.</pre>
</div>
<div class="code" title="File: Core.v
Line: 279
Time: 0.002s">
<div class="time" style="width: 0.90909090909091%"></div>
<pre>

Definition equiv_path_Tr `{Univalence} {n A} (x y : A)
  : Tr n (x = y) &lt;~&gt; (tr x = tr y :&gt; Tr n.+1 A)
  := equiv_path_SepO x y.</pre>
</div>
<div class="code" title="File: Core.v
Line: 283
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Iterated truncations *)

</pre>
</div>
<div class="code" title="File: Core.v
Line: 286
Time: 0.004s">
<div class="time" style="width: 1.8181818181818%"></div>
<pre>Definition Trunc_min n m X : Tr n (Tr m X) &lt;~&gt; Tr (trunc_index_min n m) X.</pre>
</div>
<div class="code" title="File: Core.v
Line: 286
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 287
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct (trunc_index_min_path n m) as [p|q].</pre>
</div>
<div class="code" title="File: Core.v
Line: 288
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 289
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (l := trunc_index_min_leq_right n m).</pre>
</div>
<div class="code" title="File: Core.v
Line: 289
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>
    destruct p^; clear p.</pre>
</div>
<div class="code" title="File: Core.v
Line: 290
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    symmetry.</pre>
</div>
<div class="code" title="File: Core.v
Line: 291
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    serapply equiv_adjointify.</pre>
</div>
<div class="code" title="File: Core.v
Line: 292
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Core.v
Line: 293
Time: 0.002s">
<div class="time" style="width: 0.90909090909091%"></div>
<pre> serapply Trunc_rec.</pre>
</div>
<div class="code" title="File: Core.v
Line: 293
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (fun x =&gt; tr (tr x)).</pre>
</div>
<div class="code" title="File: Core.v
Line: 294
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Core.v
Line: 294
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Core.v
Line: 295
Time: 0.002s">
<div class="time" style="width: 0.90909090909091%"></div>
<pre> serapply Trunc_rec.</pre>
</div>
<div class="code" title="File: Core.v
Line: 295
Time: 0.009s">
<div class="time" style="width: 4.0909090909091%"></div>
<pre>
      serapply Trunc_rec.</pre>
</div>
<div class="code" title="File: Core.v
Line: 296
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>
      1: serapply trunc_leq.</pre>
</div>
<div class="code" title="File: Core.v
Line: 297
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact tr.</pre>
</div>
<div class="code" title="File: Core.v
Line: 298
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Core.v
Line: 298
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Core.v
Line: 299
Time: 0.025s">
<div class="time" style="width: 11.363636363636%"></div>
<pre> serapply Trunc_ind.</pre>
</div>
<div class="code" title="File: Core.v
Line: 299
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      simpl.</pre>
</div>
<div class="code" title="File: Core.v
Line: 300
Time: 0.066s">
<div class="time" style="width: 30%"></div>
<pre>
      serapply (Trunc_ind (n:=m)).</pre>
</div>
<div class="code" title="File: Core.v
Line: 301
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      2: reflexivity.</pre>
</div>
<div class="code" title="File: Core.v
Line: 302
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intro.</pre>
</div>
<div class="code" title="File: Core.v
Line: 303
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply istrunc_paths.</pre>
</div>
<div class="code" title="File: Core.v
Line: 304
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>
      serapply (trunc_leq (m:=n)).</pre>
</div>
<div class="code" title="File: Core.v
Line: 305
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      by apply trunc_index_leq_succ'.</pre>
</div>
<div class="code" title="File: Core.v
Line: 306
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Core.v
Line: 306
Time: 0.024s">
<div class="time" style="width: 10.909090909091%"></div>
<pre>
    serapply Trunc_ind; reflexivity.</pre>
</div>
<div class="code" title="File: Core.v
Line: 307
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Core.v
Line: 308
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> set (min := trunc_index_min n m).</pre>
</div>
<div class="code" title="File: Core.v
Line: 308
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>
    refine (paths_ind _
      (fun m _ =&gt; Tr n (Tr m X) &lt;~&gt; Tr min X) _ m q).</pre>
</div>
<div class="code" title="File: Core.v
Line: 310
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold min; clear min.</pre>
</div>
<div class="code" title="File: Core.v
Line: 311
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    symmetry.</pre>
</div>
<div class="code" title="File: Core.v
Line: 312
Time: 0.005s">
<div class="time" style="width: 2.2727272727273%"></div>
<pre>
    serapply equiv_tr.</pre>
</div>
<div class="code" title="File: Core.v
Line: 313
Time: 0.013s">
<div class="time" style="width: 5.9090909090909%"></div>
<pre>
    serapply trunc_leq.</pre>
</div>
<div class="code" title="File: Core.v
Line: 314
Time: 0.002s">
<div class="time" style="width: 0.90909090909091%"></div>
<pre>
    3: exact _.</pre>
</div>
<div class="code" title="File: Core.v
Line: 315
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply trunc_index_min_leq_left.</pre>
</div>
<div class="code" title="File: Core.v
Line: 316
Time: 0.008s">
<div class="time" style="width: 3.6363636363636%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 317
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition Trunc_swap n m X : Tr n (Tr m X) &lt;~&gt; Tr m (Tr n X).</pre>
</div>
<div class="code" title="File: Core.v
Line: 319
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Core.v
Line: 320
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>
  refine (_ oE equiv_transport (fun x =&gt; Tr x _) _ _ _ oE Trunc_min n m _).</pre>
</div>
<div class="code" title="File: Core.v
Line: 321
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  2: apply trunc_index_min_swap.</pre>
</div>
<div class="code" title="File: Core.v
Line: 322
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  symmetry.</pre>
</div>
<div class="code" title="File: Core.v
Line: 323
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply Trunc_min.</pre>
</div>
<div class="code" title="File: Core.v
Line: 324
Time: 0.001s">
<div class="time" style="width: 0.45454545454545%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Core.v
Line: 326
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** If you are looking for a theorem about truncation, you may want to read the note "Finding Theorems" in "STYLE.md". *)

</pre>
</div>
</body>
</html>

